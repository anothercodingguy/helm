services:
  # --------------------------------------------------------------------------------
  # FRONTEND (Next.js)
  # --------------------------------------------------------------------------------
  - type: web
    name: saas-frontend
    plan: free
    runtime: node
    rootDir: frontend
    buildCommand: npm install && npm run build
    startCommand: npm start
    envVars:
      - key: NEXT_PUBLIC_API_BASE_URL
        sync: false 

  # --------------------------------------------------------------------------------
  # BACKEND (Node/Express)
  # --------------------------------------------------------------------------------
  - type: web
    name: saas-backend
    plan: free
    runtime: docker
    rootDir: backend
    dockerfilePath: backend/Dockerfile
    envVars:
      - key: PORT
        value: 5000
      - key: DATABASE_URL
        fromDatabase:
          name: saas-db
          property: connectionString
      - key: MOLTBOT_BASE_URL
        value: http://moltbot:7000
      - key: JWT_SECRET
        generateValue: true
      - key: PHONEPE_MERCHANT_ID
        sync: false
      - key: PHONEPE_SALT_KEY
        sync: false
      - key: USE_MOCK_BOT
        value: false
      - key: USE_MOCK_PAYMENT
        value: false

  # --------------------------------------------------------------------------------
  # MOLTBOT (Internal Agent)
  # --------------------------------------------------------------------------------
  - type: web
    name: moltbot
    plan: free
    runtime: docker
    rootDir: moltbot
    dockerfilePath: moltbot/Dockerfile
    envVars:
      - key: PORT
        value: 7000
      - key: ANTHROPIC_API_KEY
        sync: false

databases:
  # --------------------------------------------------------------------------------
  # MANAGED POSTGRES
  # --------------------------------------------------------------------------------
  - name: saas-db
    plan: free
    databaseName: saas_db
    user: saas_user
